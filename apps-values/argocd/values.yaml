server:
  extraArgs:
  - --insecure
  - --staticassets
  - /shared/app
  - --redis
  - argocd-redis:6379
  # Set service type to ClusterIP (default for Istio)
  service:
    type: ClusterIP

# Add the Istio configuration here
extraObjects:
- apiVersion: networking.istio.io/v1alpha3
  kind: Gateway
  metadata:
    name: argocd-gateway
  spec:
    selector:
      istio: ingressgateway
    servers:
    - port:
        number: 80
        name: http
        protocol: HTTP
      hosts:
      - "*"
- apiVersion: networking.istio.io/v1alpha3
  kind: VirtualService
  metadata:
    name: argocd-vs
  spec:
    hosts:
    - "*"
    gateways:
    - argocd-gateway
    http:
    - route:
      - destination:
          host: argocd-server
          port:
            number: 80
